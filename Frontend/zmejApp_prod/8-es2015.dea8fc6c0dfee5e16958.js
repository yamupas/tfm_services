(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"2grs":function(e,t,s){"use strict";s.r(t),s.d(t,"UserModule",(function(){return k}));var a=s("PCNd"),i=s("tyNb"),r=s("0IaG"),o=s("3Pt+"),l=s("AytR"),n=s("fXoL"),c=s("XiUz"),d=s("kmnG"),u=s("qFsG"),b=s("ofXK"),h=s("bSwM"),g=s("bTqV");const m=["class","component"];function p(e,t){1&e&&(n.Yb(0,"mat-error"),n.Mc(1,"ingrese un nombre "),n.Xb())}function f(e,t){1&e&&(n.Yb(0,"mat-error"),n.Mc(1,"usuario de red "),n.Xb())}function y(e,t){1&e&&(n.Yb(0,"mat-error"),n.Mc(1,"ingrese un nombre "),n.Xb())}function v(e,t){if(1&e){const e=n.Zb();n.Yb(0,"mat-checkbox",14),n.gc("change",(function(s){n.Cc(e);const a=t.$implicit;return n.kc().onChange(a.id,s.checked)})),n.Mc(1),n.Xb()}if(2&e){const e=t.$implicit,s=n.kc();n.rc("value",e.id),n.rc("id",e.id),n.qc("checked",s.chekedRole(e)),n.Eb(1),n.Nc(e.normalizedName)}}let x=(()=>{class e{constructor(e,t,s){this.dialogRef=e,this.data=t,this.fb=s,this.vData={},this.rolesData=[],this.vData=this.data.users,this.rolesData=this.data.roles,console.log(this.rolesData),this.formRegister=this.fb.group({id:"",applicationId:l.a.aplicationId,fullName:[null,o.w.compose([o.w.required,o.w.minLength(6)])],email:[null],userName:[null,o.w.compose([o.w.required,o.w.minLength(3)])],lockoutEnabled:[!1],roles:this.fb.array([])}),this.setUserData()}cancel(){this.dialogRef.close(!1)}setUserData(){try{if(null!=this.vData){let e=this.data.users;this.formRegister.controls.userName.setValue(e.userName),this.formRegister.controls.applicationId.setValue(l.a.aplicationId),this.formRegister.controls.id.setValue(e.id),this.formRegister.controls.fullName.setValue(e.fullName),this.formRegister.controls.email.setValue(e.email),this.formRegister.controls.lockoutEnabled.setValue(e.lockoutEnabled),null!=e.roles&&e.roles.length&&e.roles.forEach(e=>{this.onChange(e.id,!0)})}}catch(e){}}onChange(e,t){const s=this.formRegister.controls.roles;if(t)s.push(new o.f(e));else{let t=s.controls.findIndex(t=>t.value==e);s.removeAt(t)}}chekedRole(e){try{if(null!=this.data.users&&null!=this.data.users){const t=this.data.users.roles.filter(t=>t.id==e.id);return null!=t&&t.length>0}}catch(t){return!1}}}return e.\u0275fac=function(t){return new(t||e)(n.Sb(r.g),n.Sb(r.a),n.Sb(o.e))},e.\u0275cmp=n.Mb({type:e,selectors:[["ngx-dialog-maquinas-confirm",8,"component"]],attrs:m,decls:39,vars:7,consts:[["mat-dialog-title",""],["fxLayout","row wrap",1,"matero-row"],[1,"form-field-full",3,"formGroup"],["fxLayout","row wrap","fxLayoutGap","8px grid"],["fxFlex","50","fxFlex.lt-md","100"],["matInput","","placeholder","C\xf3digo SAP","formControlName","fullName","maxlength","300","required",""],[4,"ngIf"],["matInput","","placeholder","C\xf3digo SAP","formControlName","userName","maxlength","300","required",""],["matInput","","placeholder","Correo Electronico","formControlName","email","maxlength","300","required",""],["fxFlex","50","fxFlex.lt-sm","100"],["id","amateur","color","primary","formControlName","lockoutEnabled",1,"amateur"],["id","amateur",3,"checked","value","id","change",4,"ngFor","ngForOf"],["mat-raised-button","","mat-dialog-close","",3,"click"],["mat-raised-button","","color","primary","mat-dialog-close","","cdkFocusInitial","",3,"mat-dialog-close","disabled"],["id","amateur",3,"checked","value","id","change"]],template:function(e,t){1&e&&(n.Yb(0,"h2",0),n.Mc(1,"Crear o editar usuario"),n.Xb(),n.Yb(2,"div",1),n.Yb(3,"mat-dialog-content"),n.Yb(4,"form",2),n.Yb(5,"div",3),n.Yb(6,"div",4),n.Yb(7,"mat-form-field"),n.Yb(8,"mat-label"),n.Mc(9,"Nombre Completo"),n.Xb(),n.Tb(10,"input",5),n.Kc(11,p,2,0,"mat-error",6),n.Xb(),n.Xb(),n.Yb(12,"div",4),n.Yb(13,"mat-form-field"),n.Yb(14,"mat-label"),n.Mc(15,"Usuario de Red"),n.Xb(),n.Tb(16,"input",7),n.Kc(17,f,2,0,"mat-error",6),n.Xb(),n.Xb(),n.Yb(18,"div",4),n.Yb(19,"mat-form-field"),n.Yb(20,"mat-label"),n.Mc(21,"Correo Electronico"),n.Xb(),n.Tb(22,"input",8),n.Kc(23,y,2,0,"mat-error",6),n.Xb(),n.Xb(),n.Yb(24,"div",9),n.Tb(25,"br"),n.Yb(26,"mat-checkbox",10),n.Mc(27,"Cuenta deshabilitada?"),n.Xb(),n.Xb(),n.Yb(28,"div",9),n.Tb(29,"br"),n.Yb(30,"mat-label"),n.Mc(31,"Roles de usuario"),n.Xb(),n.Tb(32,"br"),n.Kc(33,v,2,4,"mat-checkbox",11),n.Xb(),n.Xb(),n.Xb(),n.Xb(),n.Yb(34,"mat-dialog-actions"),n.Yb(35,"button",12),n.gc("click",(function(){return t.cancel()})),n.Mc(36,"Cancelar"),n.Xb(),n.Yb(37,"button",13),n.Mc(38,"Aceptar"),n.Xb(),n.Xb(),n.Xb()),2&e&&(n.Eb(4),n.qc("formGroup",t.formRegister),n.Eb(7),n.qc("ngIf",t.formRegister.get("fullName").invalid),n.Eb(6),n.qc("ngIf",t.formRegister.get("userName").invalid),n.Eb(6),n.qc("ngIf",t.formRegister.get("email").invalid),n.Eb(10),n.qc("ngForOf",t.rolesData),n.Eb(4),n.qc("mat-dialog-close",t.formRegister.value)("disabled",!t.formRegister.valid))},directives:[r.h,c.c,r.e,o.x,o.q,o.j,c.d,c.a,d.c,d.g,u.b,o.c,o.p,o.h,o.l,o.v,b.n,h.a,b.m,r.c,g.b,r.d,d.b],styles:["table[_ngcontent-%COMP%]{width:100%}.example-section[_ngcontent-%COMP%]{margin:12px 0}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}"]}),e})();var q=s("+0xr"),C=s("GJmQ"),X=s("ey9i"),L=s("M0ag"),Y=s("5eHb"),w=s("tgey"),M=s("hGDI");const N=function(){return[5,10,20]};let R=(()=>{class e{constructor(e,t,s,a,i,r){this._usersService=e,this._router=t,this.dialog=s,this._toastrService=a,this.pagerService=i,this.cdr=r,this.isAuthenticated=!1,this.ListRoles=[],this.columns=[{header:"Nombre",field:"fullName"},{header:"Usuario",field:"userName"},{header:"Correo",field:"email"},{header:"Opci\xf3n",field:"option",width:"120px",pinned:"right",right:"0px",type:"button",buttons:[{icon:"edit",tooltip:"Editar",type:"icon",click:e=>this.editUser(e)}]}],this.alive=!0,this.list=[],this.total=0,this.isLoading=!0,this.query={q:"",sort:"stars",order:"desc",page:0,per_page:10},this.isAuthenticated=!0,this.GetAllUserList(),this.GetAllRolesList()}ngOnInit(){}GetAllUserList(){try{this._usersService.get("api/users/getall/"+l.a.aplicationId).pipe(Object(C.a)(()=>this.alive)).subscribe(e=>{this.ListUsers=new q.o(e.body),this.ListUsers=e.body,this.ListUsersdatasearch=e.body,this.total=this.ListUsers.length,this.setpage(),this.isLoading=!1,this.cdr.detectChanges()})}catch(e){}}GetAllRolesList(){try{this._usersService.get("api/users/GetAllByApplication/"+l.a.aplicationId).pipe(Object(C.a)(()=>this.alive)).subscribe(e=>{this.ListRoles=e.body})}catch(e){}}get params(){const e=Object.assign({},this.query);return e.page+=1,Object(L.a)(e)}getNextPage(e){this.query.page=e.pageIndex,this.query.per_page=e.pageSize,this.setpage()}search(){let e=this.query.q.toLocaleLowerCase();this.ListUsersdatasearch=this.ListUsers.filter(t=>t.fullName.toLocaleLowerCase().includes(e)),this.query.page=0,this.setpage()}setpage(){let e=this.pagerService.getPager(this.ListUsersdatasearch.length,this.query.page+1,this.query.per_page);this.list=this.ListUsersdatasearch.slice(e.startIndex,e.endIndex+1)}editUser(e){console.log(this.ListRoles),this.dialog.open(x,{width:"900px",data:{users:e,roles:this.ListRoles},panelClass:"ModalPanelClass",closeOnNavigation:!1,disableClose:!0}).afterClosed().subscribe(t=>{console.log(t),t&&(null!=e?(t.id=e.id,this.updateUser(t)):this.AddUser(t))})}updateUser(e){try{this._usersService.post("api/users/update",e).pipe(Object(C.a)(()=>this.alive)).subscribe(e=>{200==e.status&&this.GetAllUserList()},e=>{})}catch(t){console.log(t)}}AddUser(e){try{this._usersService.post("api/users/save",e).pipe(Object(C.a)(()=>this.alive)).subscribe(e=>{200==e.status?(this.GetAllUserList(),this._toastrService.success("datos guardados correctamente")):this._toastrService.error("error",403==e.status?"No tienes permiso para realizar esta accion":"error al guardar intente mas tarde")},e=>{})}catch(t){console.log(t)}}}return e.\u0275fac=function(t){return new(t||e)(n.Sb(X.i),n.Sb(i.f),n.Sb(r.b),n.Sb(Y.b),n.Sb(X.e),n.Sb(n.h))},e.\u0275cmp=n.Mb({type:e,selectors:[["ngx-users-table"]],decls:9,vars:10,consts:[[1,"bg-blue-600"],[1,"m-r-8"],["matInput","","name","q","placeholder","Buscar por nombre",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary",1,"m-r-8",3,"click"],[3,"data","columns","length","loading","pageOnFront","pageIndex","pageSize","pageSizeOptions","page"]],template:function(e,t){1&e&&(n.Tb(0,"page-header",0),n.Yb(1,"form"),n.Yb(2,"mat-form-field",1),n.Yb(3,"input",2),n.gc("ngModelChange",(function(e){return t.query.q=e})),n.Xb(),n.Xb(),n.Yb(4,"button",3),n.gc("click",(function(){return t.search()})),n.Mc(5,"Buscar"),n.Xb(),n.Yb(6,"button",3),n.gc("click",(function(){return t.editUser(null)})),n.Mc(7,"Crear"),n.Xb(),n.Xb(),n.Yb(8,"mtx-grid",4),n.gc("page",(function(e){return t.getNextPage(e)})),n.Xb()),2&e&&(n.Eb(3),n.qc("ngModel",t.query.q),n.Eb(5),n.qc("data",t.list)("columns",t.columns)("length",t.total)("loading",t.isLoading)("pageOnFront",!1)("pageIndex",t.query.page)("pageSize",t.query.per_page)("pageSizeOptions",n.sc(9,N)))},directives:[w.a,o.x,o.q,o.r,d.c,u.b,o.c,o.p,o.s,g.b,M.a],styles:["table[_ngcontent-%COMP%]{width:100%}"]}),e})();const S=[{path:"",component:R},{path:"list",component:R,data:{title:"Usuarios"}}];let U=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[i.j.forChild(S)],i.j]}),e})(),k=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[a.a,U]]}),e})()}}]);